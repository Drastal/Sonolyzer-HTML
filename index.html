<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Sonolyzer</title>
        <link href="css/reset.css" rel="stylesheet" media="screen">
        <link href="css/template.css" rel="stylesheet" media="screen">
        <link href="css/components.css" rel="stylesheet" media="screen">
        <link href="css/modals.css" rel="stylesheet" media="screen">
      
    </head>
    <body>
        <header>
            <div class="appName">
                <h1><a href="index.html"> Sonolyzer </a></h1>
            </div>
            
            <a href="#help" class="icon"><img src="img/help.png" /></a>
            <div id="help" class="modal">
                <div class="popup">
                    <div class="header">
                            <h2>Aide</h2>
                    </div>
                    <div class="content">
                        <h3>&Agrave; propos</h3>
                        <p>Va falloir une fine plume les gens</p>
                        <h3>Charger une bande sonore</h3>
                        <p>Ici aussi, de toute évidence</p>
                        <h3>Lecteur audio</h3>
                        <p>Vous connaissez la chanson</p>
                        <h3>Filtres</h3>
                        <p>On r'met &ccedil;a ?</p>
                        <h3>Export</h3>
                        <p>Une autre patron</p>
                    </div>
                    <div class="footer">
                        <a href="#" class="closeButton">Fermer</a>
                    </div>
                </div>
                <div class="overlay"></div>
            </div>
            
            <a href="#settings" class="icon"><img src="img/settings.png" /></a>
            <div id="settings" class="modal">
                <div class="popup">
                    <div class="header">
                        <h2>Param&egrave;tres</h2>
                    </div>
                    <div class="content">
                        <h3>G&eacute;n&eacute;rales</h3>
                        <p>Couleur, etc...</p>
                        <h3>Fitres</h3>
                        <p>Que met-on ?</p>
                    </div>
                    <div class="footer">
                        <a href="#" class="closeButton">Fermer</a>
                    </div>
                </div>
                <div class="overlay"></div>
            </div>
        </header>

		<div class="main">
            <div class="fileManagerBand">
                <aside class="left">
                    <form id="searchFile" class="icon">
                        <input type="search" placeholder="Search">
                    </form>
                    <a href="#" class="icon"><img src="img/reload.png" /></a>
                </aside>
                <aside class="right">
                    <a href="#"><p class="address">Test d'adresse</p></a>
                </aside>
            </div>

			<div class="panels">
                <aside class="left">
                    <section class="filters">
                        <div class="filterType">
                            <h3 class="filterTitle">Voix</h3>
                            <div class="doubleFilter">
                            	<span class="choiceLeft">
                                	Intensifier
                                </span>
                                <span class="switchTwin">
                                    <div class="onoffswitch">
                                        <input type="checkbox" name="voiceLevel" class="onoffswitch-checkbox" id="voiceLevel">
                                        <label class="onoffswitch-label" for="voiceLevel">
                                            <div class="onoffswitch-inner"></div>
                                            <div class="onoffswitch-switch"></div>
                                        </label>
                                    </div>
                                </span>
                                <span class="choiceRight">
                                	R&eacute;duire
                                </span>
                            </div>
                            <div class="doubleFilter">
                            	<span class="choiceLeft">
                                	Aigues
                                </span>
                                <span class="switchTwin">
                                    <div class="onoffswitch">
                                        <input type="checkbox" name="voiceType" class="onoffswitch-checkbox" id="voiceType">
                                        <label class="onoffswitch-label" for="voiceType">
                                            <div class="onoffswitch-inner"></div>
                                            <div class="onoffswitch-switch"></div>
                                        </label>
                                    </div>
                                </span>
                                <span class="choiceRight">
                                	Graves
                                </span>
                            </div>
                        </div>
                        <div class="filterNoise">
                            <h3 class="filterTitle">R&eacute;duction de bruit</h3>
                            <div class="singleFilter">
                            	<span class="label">
                                	Interf&eacute;rences
                                </span>
                                <span class="switchSingle">
                                    <div class="onoffswitch">
                                        <input type="checkbox" name="interference" class="onoffswitch-checkbox" id="interference">
                                        <label class="onoffswitch-label" for="interference">
                                            <div class="onoffswitch-inner"></div>
                                            <div class="onoffswitch-switch"></div>
                                        </label>
                                    </div>
                                </span>
                            </div>
                            <div class="singleFilter">
                            	<span class="label">
                                	Circulation
                                </span>
                                <span class="switchSingle">
                                    <div class="onoffswitch">
                                        <input type="checkbox" name="road" class="onoffswitch-checkbox" id="road">
                                        <label class="onoffswitch-label" for="road">
                                            <div class="onoffswitch-inner"></div>
                                            <div class="onoffswitch-switch"></div>
                                        </label>
                                    </div>
                                </span>
                            </div>
                            <div class="singleFilter">
                            	<span class="label">
                                	&Eacute;cho
                                </span>
                                <span class="switchSingle">
                                    <div class="onoffswitch">
                                        <input type="checkbox" name="echo" class="onoffswitch-checkbox" id="echo">
                                        <label class="onoffswitch-label" for="echo">
                                            <div class="onoffswitch-inner"></div>
                                            <div class="onoffswitch-switch"></div>
                                        </label>
                                    </div>
                                </span>
                            </div>
                        </div>
                        <div class="filterType">
                            <h3 class="filterTitle">Personnalis&eacute;s</h3>
                            <div class="doubleFilter">
                                <span class="choiceLeft">
                                    Passe-haut
                                </span>
                                <span class="switchTwin">
                                    <div class="onoffswitch">
                                        <input type="checkbox" name="passeFilter" class="onoffswitch-checkbox" id="passeFilter">
                                        <label class="onoffswitch-label" for="passeFilter">
                                            <div class="onoffswitch-inner"></div>
                                            <div class="onoffswitch-switch"></div>
                                        </label>
                                    </div>
                                </span>
                                <span class="choiceRight">
                                    Passe-bas
                                </span>
                            </div>
                            <div class="frequencyRange">
                                <form oninput="amount.value=rangePass.value">
                                    <input type="range" class="horizon" id="rangePass" name="rangePass" value="50" min="20" max="24000" step="10">
                                    <span class="smallerToRight">
                                    	f<sub>C</sub> = 
                                        <div class="output">
                                        	<output name="amount" for="rangePass">?</output>
                                        </div>
                                        kHz
                                    </span>
                                </form>
                            </div>
                            <div class="doubleFilter">
                                <span class="choiceLeft">
                                    Passe-bande
                                </span>
                                <span class="switchTwin">
                                    <div class="onoffswitch">
                                        <input type="checkbox" name="bandeFilter" class="onoffswitch-checkbox" id="bandeFilter">
                                        <label class="onoffswitch-label" for="bandeFilter">
                                            <div class="onoffswitch-inner"></div>
                                            <div class="onoffswitch-switch"></div>
                                        </label>
                                    </div>
                                </span>
                                <span class="choiceRight">
                                    Coupe-bande
                                </span>
                            </div>
                            <div class="frequencyRange">
                                <form oninput="amount.value=rangeLowBand.value">
                                    <input type="range" class="horizon" id="rangeLowBand" name="rangeLowBand" value="50" min="20" max="24000" step="10">
                                    <span class="smallerToRight">
                                    	f<sub>Cb</sub> = 
                                        <div class="output">
                                        	<output name="amount" for="rangeLowBand">?</output>
                                        </div>
                                        kHz
                                    </span>
                                </form>
                            </div>
                            <div class="frequencyRange">
                                <form oninput="amount.value=rangeHighBand.value">
                                    <input type="range" class="horizon" id="rangeHighBand" name="rangeHighBand" value="50" min="20" max="24000" step="10">
                                    <span class="smallerToRight">
                                    	f<sub>Ch</sub> = 
                                        <div class="output">
                                        	<output name="amount" for="rangeHighBand">?</output>
                                        </div>
                                        kHz
                                    </span>
                                </form>
                            </div>
                        </div>
                    </section>
                    <section class="export">
                        <a href="#"><p>
                            EXPORT
                        </p></a>
                    </section>
                </aside>
                
                <aside class="right">
                    <section class="player">
                        <p>
                        	Player
                        </p>
                    </section>
                    
                    <section class="spectrum">      
				<canvas id="canvas" width="1000" height="325" style="display: block;margin-right: auto; margin-left: auto;">Spectre du signal audio</canvas>		
                    </section>
                    
                    <section class="platine">
                        <p>
                        	Platine
                        </p>
                    </section>
                </aside>
            </div>
		</div>

		<footer>
			<!-- Contenu du footer -->
		</footer>
        
 			<script>

				// create the audio context (chrome only for now)
				var context = new webkitAudioContext();
				var audioBuffer;
				var sourceNode;
				var analyser;
				var javascriptNode;
				var filter;
				
                                //création du flux
				window.audio = new Audio ();
				audio.src = "sounds/Perth.m4a";
				audio.controls = true;
				audio.autoplay = true;
				audio.loop = true;

				// get the context from the canvas to draw on
				var c = document.getElementById("canvas");
				var ctx = c.getContext("2d");

				// create a gradient for the fill. Note the strange
				// offset, since the gradient is calculated based on
				// the canvas, not the specific element we draw
				var gradient = ctx.createLinearGradient(0,0,0,300);
				gradient.addColorStop(1,'#000000');
				gradient.addColorStop(0.75,'#00ffff');
				gradient.addColorStop(0.25,'#00ff00');
				gradient.addColorStop(0,'#ffffff');


				// load the sound
				setupAudioNodes();


				function setupAudioNodes() {

					// setup a javascript node
					javascriptNode = context.createJavaScriptNode(2048, 1, 1);
					
					// connect to destination, else it isn't called
					javascriptNode.connect(context.destination);


					// setup a analyzer
					analyser = context.createAnalyser();
					analyser.smoothingTimeConstant = 0.3;
					analyser.fftSize = 512;

					//setsup a filter
					filter = context.createBiquadFilter();
					filter.type = filter.PEAKING;  // In this case it's a NOTCH filter
					filter.frequency.value = 600.0;
					filter.Q = 1.0;
					filter.gain.value=-40;
					
					
					// create a buffer source node
					//sourceNode = context.createBufferSource();
					sourceNode = context.createMediaElementSource(audio);
					
					//filtre non-connecté
					sourceNode.connect(analyser);
					
					//filtre connecté
					//sourceNode.connect(filter);
					//filter.connect(analyser);
					
					analyser.connect(javascriptNode);

					//filtre connecté
					//filter.connect(context.destination);
					
					//filtre non-connecté
					sourceNode.connect(context.destination);
				}

				// log if an error occurs
				function onError(e) {
					console.log(e);
				}

				// when the javascript node is called
				// we use information from the analyzer node
				// to draw the volume
				javascriptNode.onaudioprocess = function() {

					// get the average for the first channel
					var array =  new Uint8Array(analyser.frequencyBinCount);
					analyser.getByteFrequencyData(array);

					// clear the current state
					ctx.clearRect(0, 0, 1000, 325);

					// set the fill style
					ctx.fillStyle=gradient;
					drawSpectrum(array);

				}


				function drawSpectrum(array) {
					for ( var i = 0; i < (array.length); i++ ){
						var value = array[i];

						ctx.fillRect(i*5,325-value,3,325);
						//  console.log([i,value])
					}
				};

			</script>
	</body>
</html>